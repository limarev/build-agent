name: Publishing
run-name: Publish new libreoffice release ${{ github.ref_name }}

on:
  [push]
    # tags:
      # - '*'

env: 
  REPO: LibreOffice/core

jobs:
  build:
    runs-on: self-hosted
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        # with:
        #   repository: LibreOffice/core
        #   ref: ${{ github.ref_name }}
        #   submodules: 'recursive'
        #   path: './core'
      - name: Build info
        run: |
          echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
          echo "üêß This job is now running on a ${{ runner.os }} server!"
          echo "üîé This job builds $REPO repository ${{ github.ref_name }} tag for adnroid."
          whoami
          docker pull hello-world
          docker run hello-world
          ls ${{ github.workspace }}
      - name: Test dockerization
        uses: docker://hello-world:latest

      - name: Build
        uses: docker://klimarev/lo_co_build_env:1.5
        with:
          args: >-
            -v ${{ github.workspace }}/core:/home/user/build
            -w /home/user
            CPAndroidX86_64

      # - name: Archive android_* artifacts
      #   run: |
      #     tar czvf android_armeabi-v7a_core_${{ github.ref_name }}.tar.gz core
      #     tar czvf android_arm64-v8a_core_${{ github.ref_name }}.tar.gz LICENSE
      #     tar czvf android_x86_core_${{ github.ref_name }}.tar.gz LICENSE
      #     tar czvf android_x86_64_core_${{ github.ref_name }}.tar.gz LICENSE
      # - name: Upload files to a GitHub release
      #   uses: svenstaro/upload-release-action@2.7.0
      #   with:
      #     file: "*.tar.gz"
      #     overwrite: true
      #     file_glob: true
      #     release_name: android_core_${{ github.ref_name }}
      #     body: "These are compiled LibreOffice core ${{ github.ref_name }} for Android for 4 platforms: armeabi-v7a, arm64-v8a, x86, x86_64"
      - run: echo "üçè This job's status is ${{ job.status }}."
